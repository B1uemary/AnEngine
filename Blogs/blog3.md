# 一个引擎
上一篇新建了一个D3D程序的基本架构D3D12AppBase，那么如果想让程序运行，只需要用一个自定义类继承D3D12AppBase，从中添加逻辑即可。
### 渲染管线
对于DX来说，如果想要渲染一个三角形，其在显卡上要通过“渲染管线”来进行渲染。渲染管线就像生产流水线一样，将渲染分阶段进行，不同阶段可以并行进行，大大提高了硬件利用率和程序效率。

D3D的渲染管线：局部坐标变换 -> 世界坐标变换 -> 观察坐标变换 -> 背面消除 -> 光照 -> 裁剪 -> 投影 -> 视口计算 -> 光栅化

对于现代显卡来说，渲染管线大部分工作可以通过硬件完成。抛弃坐标变换、背面剔除等工作，将一个三角形渲染到屏幕上，令其坐标都在屏幕中，那么显卡的输入是三角形顶点的坐标和颜色，输出为光栅化的像素。所以在渲染管线中，GPU的处理流程是可以通过Shader控制的。

* Vertex Shader：顶点着色器，在坐标变换和光照计算时工作。输入一般为顶点坐标和颜色。
* Pixel Shader：像素着色器，有时也成为Fragment Shader（片元着色器），在光栅化时工作，输入是顶点着色器的输出，输出一定格式的颜色。
* Geometry Shader：几何着色器，位于VS和PS之间，可以利用GPU进行几何变换来补充3D对象的几何细节。比如对于某些粒子，可以用一个顶点来表示其属性，但一个顶点渲染出来是看不到的，所以可以用几何着色器将其变为4个顶点，既一个矩形，然后再到PS中继续处理。
* Hull Shader：外壳着色器（？？？），和曲面细分有关。主要负责定义细分等级（LOD）和相关控制点在细分中的“形变”趋势，需要说明的是这种形变仅仅是类似于曲率改变等小幅度的变化，而非大幅度的多边形位移。
* Domain Shader：域着色器，也和曲面细分有关。通过贴图控制的方式，实现模型的形变。这两个着色器在VS和PS之间，GS之前。
* Compute Shader：计算着色器，不属于图形流水线，但可以在图形流水线之前使用CS处理数据。其作用在于GPU并行计算。

以上着色器都是针对GPU开发，所以是并行程序。在编写的时候，针对的是单个数据。例如在渲染三角形时，VS的输入是三角形的三个顶点坐标和颜色，那么在VS编写时写的是处理一个顶点的代码，GPU会对所有输入的代码运行该Shader。

因此，渲染管线可以用另一种描述：VS -> HS -> DS -> GS -> PS。

* 固定渲染管线：渲染管线的各个阶段是固定的，最多可以编写不同阶段的Shader。
* 可编程渲染管线：渲染管线的各个阶段是可以控制的。在接下来的代码中，只用到了VS和PS，没有中间几个阶段，简化了流水线，程序效率更高。

### 同步
DirectX 12中，使用Commmand List记录渲染命令，向Command Queue提交渲染命令，Command Queue向显卡提交渲染命令。在CPU端，Command Queue提交命令后会立刻返回，GPU按Command Queue中提交的命令执行。其并行执行机制后文再说明。所以Command Queue提交命令后，CPU并不知道GPU执行这些命令需要多久，而为了安全，GPU和CPU不能同时写某个内存地址对应的数据，因此需要在GPU和CPU间做同步，以让一方等待另一方的工作状态。

### 另一个辅助类
显然在开始渲染之前要先定义渲染管线和载入资源，并在渲染过程中进行同步。